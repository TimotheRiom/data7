package data7.greycat.actions;

import data7.greycatmodel.CVENode;
import data7.model.vulnerability.Vulnerability;
import greycat.Action;
import greycat.TaskContext;
import greycat.struct.Buffer;
import greycat.struct.StringArray;

public class ActionCreateVulnerabilityNode implements Action {
    public static final String NAME = "createVulnerabilityNode";
    private final Vulnerability _vulnerability;

    public ActionCreateVulnerabilityNode(Vulnerability p_vulnerability) {
        this._vulnerability = p_vulnerability;
    }

    @Override
    public void eval(TaskContext ctx) {
        ctx.setTime(_vulnerability.getCreationTime());
        CVENode node = CVENode.create(ctx.world(), ctx.time(), ctx.graph());
        node.setIdentifier(_vulnerability.getCve());
        node.setDescription(_vulnerability.getDescription());
        node.setScore(_vulnerability.getScore());
        StringArray bugs = node.getOrCreateBugIds();
        bugs.addAll(_vulnerability.getBugIds().toArray(new String[_vulnerability.getBugIds().size()]));
        ctx.continueWith(ctx.wrap(node));
    }

    @Override
    public void serialize(Buffer builder) {
        throw new RuntimeException("Remote injection not supported.");
    }

    @Override
    public String name() {
        return NAME;
    }
}
